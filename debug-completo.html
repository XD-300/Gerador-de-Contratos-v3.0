<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Debug - Sistema Completo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-area { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        input, select { margin: 5px; padding: 8px; width: 200px; }
        button { padding: 10px 15px; margin: 5px; }
        #output { background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Teste Debug - Sistema de C√°lculo Completo</h1>
    
    <div class="debug-area">
        <h3>Campos de Teste</h3>
        <div>
            <label>Forma de Pagamento:</label>
            <select id="forma">
                <option value="">Selecione...</option>
                <option value="√Ä vista">√Ä vista</option>
                <option value="Cart√£o">Cart√£o</option>
                <option value="Boleto">Boleto</option>
            </select>
        </div>
        
        <div>
            <label>Total:</label>
            <input type="text" id="total" placeholder="R$ 0,00">
        </div>
        
        <div>
            <label>N√∫mero de Parcelas:</label>
            <input type="number" id="nParcelas" placeholder="12">
        </div>
        
        <div>
            <label>Valor da Parcela:</label>
            <input type="text" id="parcela" placeholder="R$ 0,00">
        </div>
        
        <div>
            <label>Auto-c√°lculo:</label>
            <input type="checkbox" id="auto" checked>
        </div>
    </div>
    
    <div class="debug-area">
        <h3>Testes</h3>
        <button onclick="testarSistema()">üß™ Testar Sistema Completo</button>
        <button onclick="testarCalculo()">üîÑ Testar C√°lculo</button>
        <button onclick="testarEventos()">üìù Testar Eventos</button>
        <button onclick="limparLog()">üóëÔ∏è Limpar Log</button>
    </div>
    
    <div class="debug-area">
        <h3>Console Output</h3>
        <div id="output"></div>
    </div>

    <script>
        // Sistema de log personalizado
        const outputDiv = document.getElementById('output');
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44' : '#0f0';
            outputDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };
        
        function limparLog() {
            outputDiv.innerHTML = '';
        }
        
        function testarSistema() {
            console.log('üöÄ === TESTE COMPLETO DO SISTEMA ===');
            
            // 1. Verificar carregamento dos m√≥dulos
            console.log('üì¶ Verificando m√≥dulos:');
            console.log('  - get:', typeof get);
            console.log('  - parseBRL:', typeof parseBRL);
            console.log('  - fmtBRL:', typeof fmtBRL);
            console.log('  - ContractCalculations:', typeof ContractCalculations);
            
            // 2. Verificar elementos
            console.log('üéØ Verificando elementos:');
            const elementos = ['#forma', '#total', '#nParcelas', '#parcela', '#auto'];
            elementos.forEach(sel => {
                const el = document.querySelector(sel);
                console.log(`  ${sel}: ${el ? 'OK' : 'ERRO'}`);
            });
            
            // 3. Testar fun√ß√µes b√°sicas
            console.log('üõ†Ô∏è Testando fun√ß√µes:');
            try {
                const teste1 = get('#total');
                console.log('  get("#total"):', teste1);
                
                const teste2 = parseBRL('R$ 1.200,00');
                console.log('  parseBRL("R$ 1.200,00"):', teste2);
                
                const teste3 = fmtBRL(1200);
                console.log('  fmtBRL(1200):', teste3);
            } catch (e) {
                console.error('  Erro nas fun√ß√µes:', e);
            }
        }
        
        function testarEventos() {
            console.log('üìù === TESTE DE EVENTOS ===');
            
            const totalEl = document.querySelector('#total');
            const parcelasEl = document.querySelector('#nParcelas');
            
            if (totalEl && parcelasEl) {
                console.log('üìù Simulando digita√ß√£o...');
                
                totalEl.value = 'R$ 1.200,00';
                console.log('  Total definido para:', totalEl.value);
                
                parcelasEl.value = '12';
                console.log('  Parcelas definidas para:', parcelasEl.value);
                
                // Disparar eventos
                totalEl.dispatchEvent(new Event('input', { bubbles: true }));
                totalEl.dispatchEvent(new Event('blur', { bubbles: true }));
                
                console.log('  Eventos disparados');
            } else {
                console.error('  Elementos n√£o encontrados');
            }
        }
        
        function testarCalculo() {
            console.log('üîÑ === TESTE DE C√ÅLCULO MANUAL ===');
            
            if (typeof ContractCalculations !== 'undefined') {
                try {
                    // Configurar valores
                    document.querySelector('#forma').value = 'Cart√£o';
                    document.querySelector('#total').value = 'R$ 1.200,00';
                    document.querySelector('#nParcelas').value = '12';
                    document.querySelector('#parcela').value = '';
                    
                    console.log('üìã Valores configurados');
                    
                    // Executar c√°lculo
                    ContractCalculations.recalculate(false);
                    
                    const resultado = document.querySelector('#parcela').value;
                    console.log('‚úÖ Resultado:', resultado);
                    console.log('üéØ Esperado: R$ 100,00');
                    
                } catch (e) {
                    console.error('‚ùå Erro no c√°lculo:', e);
                }
            } else {
                console.error('‚ùå ContractCalculations n√£o dispon√≠vel');
            }
        }
        
        console.log('üöÄ Sistema de debug inicializado');
    </script>
    
    <!-- Carregar m√≥dulos originais -->
    <script src="src/core/utils.js"></script>
    <script src="src/core/calculations.js"></script>
    <script src="src/core/main.js"></script>
    
    <script>
        // Aguardar carregamento
        setTimeout(() => {
            console.log('üìÑ M√≥dulos carregados, pronto para testes');
            console.log('üí° Use os bot√µes acima para testar o sistema');
        }, 1000);
    </script>
</body>
</html>