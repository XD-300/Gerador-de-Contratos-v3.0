<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Debug - Sistema de C√°lculo</title>
</head>
<body>
    <h1>Teste de Debug - Sistema de C√°lculo</h1>
    
    <div>
        <label>Forma de Pagamento:</label>
        <select id="forma">
            <option value="">Selecione...</option>
            <option value="Cart√£o">Cart√£o</option>
            <option value="Boleto">Boleto</option>
            <option value="√Ä vista">√Ä vista</option>
        </select>
    </div>
    
    <div>
        <label>Total:</label>
        <input type="text" id="total" placeholder="R$ 0,00">
    </div>
    
    <div>
        <label>N√∫mero de Parcelas:</label>
        <input type="number" id="nParcelas" min="1" max="60" value="1">
    </div>
    
    <div>
        <label>Valor da Parcela:</label>
        <input type="text" id="parcela" placeholder="R$ 0,00" readonly>
    </div>
    
    <div>
        <label>Auto-c√°lculo:</label>
        <input type="checkbox" id="auto" checked>
    </div>
    
    <button onclick="debugSistema()">üöÄ Debug Sistema</button>
    <button onclick="debugCalculo()">üîß Debug C√°lculo</button>
    <button onclick="testarCalculo()">üß™ Testar C√°lculo</button>
    
    <div id="console-output" style="background: #f0f0f0; padding: 10px; margin-top: 20px; max-height: 400px; overflow-y: auto; font-family: monospace; white-space: pre-wrap;"></div>

    <script>
        // Interceptar console.log para mostrar na p√°gina
        const originalLog = console.log;
        const outputDiv = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            outputDiv.textContent += args.join(' ') + '\n';
            outputDiv.scrollTop = outputDiv.scrollHeight;
        };
        
        console.log('üöÄ Sistema de debug iniciado');
        
        // Interceptar erros JavaScript
        window.onerror = function(message, source, lineno, colno, error) {
            console.log(`‚ùå ERRO JS: ${message}`);
            console.log(`üìç Arquivo: ${source}, Linha: ${lineno}, Coluna: ${colno}`);
            if (error && error.stack) {
                console.log(`üîç Stack: ${error.stack}`);
            }
            return false;
        };
        
        // Interceptar erros de promises rejeitadas
        window.addEventListener('unhandledrejection', function(event) {
            console.log(`‚ùå Promise rejeitada: ${event.reason}`);
        });
    </script>
    
    <!-- Carregar os m√≥dulos da aplica√ß√£o -->
    <script src="src/core/utils.js"></script>
    <script src="calculations-compatible.js"></script>
    
    <script>
        // Aguardar carregamento completo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM carregado');
            
            // Verificar se fun√ß√µes est√£o dispon√≠veis
            setTimeout(() => {
                console.log('üîç Verificando fun√ß√µes globais:');
                console.log('  - debugSistema:', typeof window.debugSistema);
                console.log('  - debugCalculo:', typeof window.debugCalculo);  
                console.log('  - testarCalculo:', typeof window.testarCalculo);
                console.log('  - ContractCalculations:', typeof window.ContractCalculations);
                console.log('  - get:', typeof window.get);
                console.log('  - parseBRL:', typeof window.parseBRL);
                console.log('  - fmtBRL:', typeof window.fmtBRL);
                console.log('  - $:', typeof window.$);
                
                // Teste b√°sico de fun√ß√£o
                if (typeof window.get === 'function') {
                    try {
                        const teste = window.get('#total');
                        console.log('‚úÖ Fun√ß√£o get() funcionando, resultado:', teste);
                    } catch (e) {
                        console.log('‚ùå Erro ao testar get():', e);
                    }
                } else {
                    console.log('‚ùå Fun√ß√£o get() n√£o est√° dispon√≠vel');
                }
                
                // Teste b√°sico de ContractCalculations
                if (typeof window.ContractCalculations === 'function' || typeof window.ContractCalculations === 'object') {
                    try {
                        console.log('‚úÖ ContractCalculations dispon√≠vel');
                        if (window.ContractCalculations.recalculate) {
                            console.log('‚úÖ M√©todo recalculate dispon√≠vel');
                        } else {
                            console.log('‚ùå M√©todo recalculate n√£o encontrado');
                        }
                    } catch (e) {
                        console.log('‚ùå Erro ao verificar ContractCalculations:', e);
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>