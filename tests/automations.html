<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Completo das Automa√ß√µes - Gerador de Contratos</title>
    <link rel="stylesheet" href="src/styles/styles.css">
    <link rel="stylesheet" href="src/styles/validations.css">
    <style>
        .test-section {
            background: #f8fafc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            margin: 5px;
            cursor: pointer;
        }
        .test-result {
            background: #f0f9ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .status-ok { color: #22c55e; }
        .status-error { color: #ef4444; }
        .status-warning { color: #f59e0b; }
    </style>
</head>
<body>
    <header>
        <h1>üß™ Teste Completo das Automa√ß√µes</h1>
        <div class="sub">Sistema de diagn√≥stico e verifica√ß√£o de todas as automa√ß√µes implementadas</div>
    </header>

    <main>
        <div class="test-section">
            <h2>üìä Status do Sistema</h2>
            <div id="systemStatus"></div>
            <button class="test-button" onclick="runSystemDiagnostic()">üîç Executar Diagn√≥stico</button>
        </div>

        <div class="test-section">
            <h2>üßÆ Teste de C√°lculo Autom√°tico</h2>
            <div class="grid cols-4">
                <div>
                    <label>Forma de Pagamento</label>
                    <select id="forma">
                        <option value="√Ä vista">√Ä vista</option>
                        <option value="Cart√£o">Cart√£o de Cr√©dito</option>
                        <option value="Boleto">Boleto Banc√°rio</option>
                    </select>
                </div>
                <div>
                    <label>Valor Total</label>
                    <input id="total" placeholder="R$ 0,00" />
                </div>
                <div>
                    <label>N√∫mero de Parcelas</label>
                    <input id="nParcelas" placeholder="12" />
                </div>
                <div>
                    <label>Valor da Parcela</label>
                    <input id="parcela" placeholder="R$ 0,00" />
                </div>
                <div>
                    <label>Valor √Ä Vista</label>
                    <input id="avista" placeholder="R$ 0,00" />
                </div>
                <div>
                    <label>Valor de Entrada</label>
                    <input id="entrada" placeholder="R$ 0,00" />
                </div>
                <div>
                    <label>Desconto</label>
                    <input id="desconto" placeholder="R$ 0,00" />
                </div>
                <div>
                    <label>Dia Vencimento</label>
                    <input id="diaVenc" placeholder="5" />
                </div>
            </div>
            <div style="margin-top: 15px;">
                <input type="checkbox" id="auto" checked /> C√°lculo Autom√°tico Ativo
                <button class="test-button" onclick="testCalculations()">üßÆ Testar C√°lculos</button>
            </div>
            <div id="calcResults" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>‚úÖ Teste de Valida√ß√£o Autom√°tica</h2>
            <div class="grid cols-3">
                <div>
                    <label>CPF Respons√°vel</label>
                    <input id="cpfResp" placeholder="000.000.000-00" />
                </div>
                <div>
                    <label>Data de Nascimento</label>
                    <input id="nascResp" placeholder="DD/MM/AAAA" />
                </div>
                <div>
                    <label>Email (opcional)</label>
                    <input id="email" placeholder="exemplo@email.com" />
                </div>
            </div>
            <button class="test-button" onclick="testValidations()">‚úÖ Testar Valida√ß√µes</button>
            <div id="validationResults" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Teste de Valores Padr√£o</h2>
            <div class="grid cols-3">
                <div>
                    <label>N√∫mero do Contrato</label>
                    <input id="contrato" readonly />
                </div>
                <div>
                    <label>Data Atual</label>
                    <input id="data" readonly />
                </div>
                <div>
                    <label>Modelo Selecionado</label>
                    <select id="modelo">
                        <option value="">Selecionar...</option>
                        <option value="Contrato_EJA">Contrato EJA</option>
                        <option value="Contrato_TEC">Contrato T√©cnico</option>
                    </select>
                </div>
            </div>
            <button class="test-button" onclick="testDefaults()">üéØ Aplicar Padr√µes</button>
            <div id="defaultsResults" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>üíæ Teste de Salvamento Autom√°tico</h2>
            <p>Digite algo nos campos acima e aguarde 2 segundos. Os dados ser√£o salvos automaticamente.</p>
            <button class="test-button" onclick="checkAutoSave()">üíæ Verificar Dados Salvos</button>
            <button class="test-button" onclick="clearAutoSave()">üóëÔ∏è Limpar Dados Salvos</button>
            <div id="saveResults" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>üìà Log de Atividades</h2>
            <div id="activityLog" class="test-result" style="height: 200px; overflow-y: auto;"></div>
            <button class="test-button" onclick="clearLog()">üóëÔ∏è Limpar Log</button>
        </div>
    </main>

    <!-- Scripts necess√°rios -->
    <script src="src/auto-calc/engine.js"></script>
    <script src="src/auto-calc/init.js"></script>
    <script src="src/core/advanced-automations.js"></script>

    <script>
        let logContainer;

        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('activityLog');
            log('üöÄ Sistema de testes inicializado');
            
            // Simular carregamento de bibliotecas
            setTimeout(() => {
                window.AutomaticCalculations = AutomaticCalculations || {};
                window.SystemAutomations = SystemAutomations || {};
                log('‚úÖ Automa√ß√µes carregadas');
            }, 500);
        });

        function log(message) {
            if (logContainer) {
                const timestamp = new Date().toLocaleTimeString();
                logContainer.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            console.log(message);
        }

        function runSystemDiagnostic() {
            const statusDiv = document.getElementById('systemStatus');
            let html = '<h3>Diagn√≥stico do Sistema:</h3>';
            
            // Verificar depend√™ncias
            html += '<h4>üì¶ Depend√™ncias:</h4>';
            html += `<div>AutomaticCalculations: ${typeof AutomaticCalculations !== 'undefined' ? '<span class="status-ok">‚úÖ OK</span>' : '<span class="status-error">‚ùå FALHOU</span>'}</div>`;
            html += `<div>SystemAutomations: ${typeof SystemAutomations !== 'undefined' ? '<span class="status-ok">‚úÖ OK</span>' : '<span class="status-error">‚ùå FALHOU</span>'}</div>`;
            
            // Verificar elementos DOM
            html += '<h4>üéØ Elementos DOM:</h4>';
            ['forma', 'total', 'parcela', 'nParcelas', 'avista', 'entrada'].forEach(id => {
                const exists = document.getElementById(id) !== null;
                html += `<div>#${id}: ${exists ? '<span class="status-ok">‚úÖ OK</span>' : '<span class="status-error">‚ùå FALHOU</span>'}</div>`;
            });
            
            statusDiv.innerHTML = html;
            log('üîç Diagn√≥stico do sistema executado');
        }

        function testCalculations() {
            const resultsDiv = document.getElementById('calcResults');
            resultsDiv.innerHTML = '<h4>Resultados dos Testes de C√°lculo:</h4>';
            
            // Teste 1: Cart√£o de cr√©dito
            log('üßÆ Testando c√°lculo para cart√£o de cr√©dito...');
            document.getElementById('forma').value = 'Cart√£o';
            document.getElementById('total').value = 'R$ 1.200,00';
            document.getElementById('nParcelas').value = '12';
            document.getElementById('parcela').value = '';
            
            if (typeof AutomaticCalculations !== 'undefined') {
                AutomaticCalculations.calculate();
                const parcela = document.getElementById('parcela').value;
                resultsDiv.innerHTML += `<div>Teste Cart√£o: ${parcela ? '<span class="status-ok">‚úÖ ' + parcela + '</span>' : '<span class="status-error">‚ùå Falhou</span>'}</div>`;
            }
            
            // Teste 2: √Ä vista
            setTimeout(() => {
                log('üí∞ Testando c√°lculo √† vista...');
                document.getElementById('forma').value = '√Ä vista';
                document.getElementById('total').value = 'R$ 1.000,00';
                document.getElementById('avista').value = '';
                
                if (typeof AutomaticCalculations !== 'undefined') {
                    AutomaticCalculations.calculate();
                    const avista = document.getElementById('avista').value;
                    resultsDiv.innerHTML += `<div>Teste √Ä Vista: ${avista ? '<span class="status-ok">‚úÖ ' + avista + '</span>' : '<span class="status-error">‚ùå Falhou</span>'}</div>`;
                }
            }, 1000);
        }

        function testValidations() {
            const resultsDiv = document.getElementById('validationResults');
            resultsDiv.innerHTML = '<h4>Resultados dos Testes de Valida√ß√£o:</h4>';
            
            // Testar CPF v√°lido
            const cpfField = document.getElementById('cpfResp');
            cpfField.value = '123.456.789-09'; // CPF inv√°lido para teste
            cpfField.dispatchEvent(new Event('blur'));
            
            setTimeout(() => {
                const hasError = cpfField.classList.contains('invalid');
                resultsDiv.innerHTML += `<div>Valida√ß√£o CPF: ${hasError ? '<span class="status-ok">‚úÖ Detectou CPF inv√°lido</span>' : '<span class="status-warning">‚ö†Ô∏è N√£o validou</span>'}</div>`;
            }, 100);
            
            // Testar email
            const emailField = document.getElementById('email');
            emailField.value = 'email-invalido';
            emailField.dispatchEvent(new Event('blur'));
            
            setTimeout(() => {
                const hasError = emailField.classList.contains('invalid');
                resultsDiv.innerHTML += `<div>Valida√ß√£o Email: ${hasError ? '<span class="status-ok">‚úÖ Detectou email inv√°lido</span>' : '<span class="status-warning">‚ö†Ô∏è N√£o validou</span>'}</div>`;
            }, 200);
            
            log('‚úÖ Testes de valida√ß√£o executados');
        }

        function testDefaults() {
            const resultsDiv = document.getElementById('defaultsResults');
            
            // Aplicar valores padr√£o
            if (typeof SystemAutomations !== 'undefined' && SystemAutomations.setupSmartDefaults) {
                SystemAutomations.setupSmartDefaults();
            }
            
            // Verificar se foram aplicados
            const contrato = document.getElementById('contrato').value;
            const data = document.getElementById('data').value;
            const modelo = document.getElementById('modelo').value;
            
            resultsDiv.innerHTML = `
                <h4>Valores Padr√£o Aplicados:</h4>
                <div>Contrato: ${contrato || '<span class="status-error">‚ùå N√£o gerado</span>'}</div>
                <div>Data: ${data || '<span class="status-error">‚ùå N√£o preenchida</span>'}</div>
                <div>Modelo: ${modelo || '<span class="status-warning">‚ö†Ô∏è N√£o selecionado</span>'}</div>
            `;
            
            log('üéØ Valores padr√£o testados');
        }

        function checkAutoSave() {
            const saved = localStorage.getItem('gerador_contratos_backup');
            const resultsDiv = document.getElementById('saveResults');
            
            if (saved) {
                const data = JSON.parse(saved);
                const keys = Object.keys(data).length;
                resultsDiv.innerHTML = `<h4>Dados Salvos Automaticamente:</h4><div><span class="status-ok">‚úÖ ${keys} campos salvos</span></div><pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                resultsDiv.innerHTML = '<div><span class="status-warning">‚ö†Ô∏è Nenhum dado salvo encontrado</span></div>';
            }
            
            log('üíæ Verifica√ß√£o de salvamento autom√°tico');
        }

        function clearAutoSave() {
            localStorage.removeItem('gerador_contratos_backup');
            document.getElementById('saveResults').innerHTML = '<div><span class="status-ok">‚úÖ Dados salvos limpos</span></div>';
            log('üóëÔ∏è Dados de salvamento autom√°tico limpos');
        }

        function clearLog() {
            logContainer.innerHTML = '';
            log('üóëÔ∏è Log de atividades limpo');
        }

        // Interceptar console.log para mostrar no log de atividades
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            if (logContainer && args[0] && typeof args[0] === 'string') {
                const message = args.join(' ');
                if (message.includes('‚úÖ') || message.includes('‚ùå') || message.includes('üîÑ') || message.includes('üí∞')) {
                    log(message);
                }
            }
        };
    </script>
</body>
</html>