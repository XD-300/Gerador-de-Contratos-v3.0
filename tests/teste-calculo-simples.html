<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste C√°lculo Simples</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .campo { margin: 10px 0; }
        input, select { padding: 8px; margin: 5px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; }
        #log { background: #000; color: #0f0; padding: 10px; height: 400px; overflow-y: auto; font-family: monospace; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Teste Sistema de C√°lculo</h1>
    
    <div class="campo">
        <label>Forma de Pagamento:</label>
        <select id="forma">
            <option value="">Selecione...</option>
            <option value="√Ä vista">√Ä vista</option>
            <option value="Cart√£o">Cart√£o</option>
            <option value="Boleto">Boleto</option>
        </select>
    </div>
    
    <div class="campo">
        <label>Total:</label>
        <input type="text" id="total" placeholder="R$ 0,00">
    </div>
    
    <div class="campo">
        <label>N√∫mero de Parcelas:</label>
        <input type="number" id="nParcelas" placeholder="12">
    </div>
    
    <div class="campo">
        <label>Valor da Parcela:</label>
        <input type="text" id="parcela" placeholder="R$ 0,00">
    </div>
    
    <div class="campo">
        <label>Auto-c√°lculo:</label>
        <input type="checkbox" id="auto" checked>
    </div>
    
    <div>
        <button onclick="testarBasico()">üß™ Teste B√°sico</button>
        <button onclick="testarCalculoManual()">üîÑ C√°lculo Manual</button>
        <button onclick="testarEventos()">üìù Testar Eventos</button>
        <button onclick="document.getElementById('log').innerHTML = ''">üóëÔ∏è Limpar</button>
    </div>
    
    <div id="log"></div>

    <script>
        // Sistema de log
        function log(msg) {
            const timestamp = new Date().toLocaleTimeString();
            document.getElementById('log').innerHTML += `[${timestamp}] ${msg}\n`;
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
            console.log(msg);
        }
        
        function testarBasico() {
            log('üöÄ === TESTE B√ÅSICO ===');
            
            // Verificar se fun√ß√µes b√°sicas est√£o dispon√≠veis
            log('Verificando fun√ß√µes b√°sicas...');
            log('typeof get: ' + typeof get);
            log('typeof parseBRL: ' + typeof parseBRL);
            log('typeof fmtBRL: ' + typeof fmtBRL);
            log('typeof ContractCalculations: ' + typeof ContractCalculations);
            
            // Testar fun√ß√µes
            if (typeof get === 'function') {
                try {
                    const testValue = get('#total');
                    log('‚úÖ get("#total") funciona: ' + testValue);
                } catch (e) {
                    log('‚ùå Erro em get(): ' + e.message);
                }
            }
            
            if (typeof parseBRL === 'function') {
                try {
                    const testParse = parseBRL('R$ 1.200,00');
                    log('‚úÖ parseBRL funciona: ' + testParse);
                } catch (e) {
                    log('‚ùå Erro em parseBRL(): ' + e.message);
                }
            }
            
            if (typeof ContractCalculations === 'object' || typeof ContractCalculations === 'function') {
                log('‚úÖ ContractCalculations est√° dispon√≠vel');
                log('typeof ContractCalculations.recalculate: ' + typeof ContractCalculations.recalculate);
            }
        }
        
        function testarCalculoManual() {
            log('üîÑ === TESTE C√ÅLCULO MANUAL ===');
            
            if (typeof ContractCalculations === 'undefined') {
                log('‚ùå ContractCalculations n√£o dispon√≠vel');
                return;
            }
            
            try {
                // Configurar dados de teste
                document.getElementById('forma').value = 'Cart√£o';
                document.getElementById('total').value = 'R$ 1.200,00';
                document.getElementById('nParcelas').value = '12';
                document.getElementById('parcela').value = '';
                
                log('üìã Configurado: Cart√£o, R$ 1.200,00, 12 parcelas');
                
                // Executar c√°lculo
                log('üîÑ Executando ContractCalculations.recalculate(false)...');
                ContractCalculations.recalculate(false);
                
                // Verificar resultado
                const resultado = document.getElementById('parcela').value;
                log('üìä Resultado: ' + resultado);
                log('üéØ Esperado: R$ 100,00');
                
                if (resultado.includes('100')) {
                    log('‚úÖ SUCESSO! C√°lculo funcionou');
                } else {
                    log('‚ùå FALHA: Resultado n√£o confere');
                }
                
            } catch (e) {
                log('‚ùå ERRO no c√°lculo: ' + e.message);
                log('Stack: ' + e.stack);
            }
        }
        
        function testarEventos() {
            log('üìù === TESTE EVENTOS ===');
            
            const totalEl = document.getElementById('total');
            
            if (totalEl) {
                log('üìù Simulando digita√ß√£o no campo total...');
                
                totalEl.value = 'R$ 1.000,00';
                log('Total definido: ' + totalEl.value);
                
                // Disparar eventos
                totalEl.dispatchEvent(new Event('input', { bubbles: true }));
                log('Evento "input" disparado');
                
                totalEl.dispatchEvent(new Event('blur', { bubbles: true }));
                log('Evento "blur" disparado');
                
            } else {
                log('‚ùå Campo total n√£o encontrado');
            }
        }
        
        log('üöÄ Sistema inicializado');
    </script>
    
    <!-- Carregar apenas os m√≥dulos essenciais -->
    <script src="src/core/utils.js"></script>
    <script src="src/core/calculations.js"></script>
    
    <script>
        // Aguardar carregamento
        setTimeout(() => {
            log('üìÑ M√≥dulos carregados');
            log('üí° Use os bot√µes para testar');
        }, 500);
    </script>
</body>
</html>