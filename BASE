<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de Contratos (Web)</title>
  <!-- jsPDF para gerar PDF no navegador -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- docx para gerar documentos Word no navegador -->
  <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js"></script>
  <style>
    :root {
      --bg: #0b1020;         /* fundo escuro elegante */
      --card: #121938;       /* cartão */
      --muted: #7f8db9;      /* texto suave */
      --text: #e8ecff;       /* texto principal */
      --pri: #5b9dff;        /* primária */
      --pri-2: #3f7fe0;      /* hover */
      --ok: #22c55e;         /* sucesso */
      --warn: #eab308;       /* aviso */
      --err: #ef4444;        /* erro */
      --border: #2a3569;     /* borda */
    }
    * { box-sizing: border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; }
    body { margin: 0; background: radial-gradient(1200px 600px at 20% 0%, #15224b, transparent), var(--bg); color: var(--text); }
    header { padding: 24px 16px; }
    h1 { margin: 0 0 6px; font-size: 28px; letter-spacing: .3px; }
    .sub { color: var(--muted); font-size: 14px; }
    main { max-width: 1100px; margin: 0 auto; padding: 16px; }

    .grid { display: grid; gap: 14px; }
    .grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid.cols-4 { grid-template-columns: repeat(4, 1fr); }

    .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid var(--border); border-radius: 14px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.15); }
    .card h2 { margin: 0 0 10px; font-size: 18px; font-weight: 700; letter-spacing: .2px; }

    label { font-size: 13px; color: var(--muted); display: block; margin: 4px 0; }
    input, select, button, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #0f1632; color: var(--text); outline: none; }
    input:focus, select:focus, textarea:focus { border-color: var(--pri); box-shadow: 0 0 0 3px rgba(91,157,255,.15); }

    .row { display: grid; grid-template-columns: 140px 1fr; align-items: center; gap: 8px; }
    .row > label { margin: 0; }

    .actions { display: flex; flex-wrap: wrap; gap: 10px; justify-content: flex-end; }
    .btn { width: auto; cursor: pointer; border: none; }
    .btn.primary { background: linear-gradient(180deg, var(--pri), var(--pri-2)); color: white; }
    .btn.ok { background: linear-gradient(180deg, #2cd074, #1db75f); color: white; }
    .btn.warn { background: linear-gradient(180deg, #facc15, #eab308); color: #1f2937; }
    .btn.ghost { background: transparent; border: 1px dashed var(--border); color: var(--muted); }

    .inline { display: flex; gap: 8px; align-items: center; }
    .hint { font-size: 12px; color: var(--muted); }
    .pill { padding: 2px 8px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted); font-size: 12px; }

    .error { border-color: var(--err) !important; }
    footer { color: var(--muted); text-align: center; font-size: 12px; padding: 18px; }
  </style>
</head>
<body>
  <header>
    <h1>Gerador de Contratos (Web)</h1>
    <div class="sub">Formulário compatível com seus campos (nome, CPF, endereço, valores) + cálculo automático (À vista, Cartão, Boleto) e exportação em PDF.</div>
  </header>

  <main class="grid">
    <!-- Seleções gerais -->
    <section class="card grid cols-4" id="sec-geral">
      <div>
        <label>Modelo</label>
        <select id="modelo">
          <option>Contrato_EJA</option>
          <option>Contrato_OM</option>
          <option>CONTRATO_OM_DK</option>
          <option>Contrato_TEC</option>
        </select>
      </div>
      <div>
        <label>Forma de pagamento</label>
        <select id="forma">
          <option>À vista</option>
          <option>Cartão</option>
          <option>Boleto</option>
        </select>
      </div>
      <div>
        <label>Data</label>
        <input id="data" placeholder="DD/MM/AAAA" />
      </div>
      <div class="inline" style="margin-top:22px">
        <span class="pill" id="pill-status">Auto-cálculo ativo</span>
        <label class="hint"><input type="checkbox" id="auto" checked style="width:auto; margin-right:6px"/> Cálculo automático</label>
      </div>
    </section>

    <!-- Responsável -->
    <section class="card">
      <h2>Responsável financeiro</h2>
      <div class="grid cols-2">
        <div>
          <label>Nome completo</label>
          <input id="nomeResp" placeholder="Ex.: Maria da Silva" />
        </div>
        <div>
          <label>Nascimento (resp.)</label>
          <input id="nascResp" placeholder="DD/MM/AAAA" />
        </div>
        <div>
          <label>CPF (resp.)</label>
          <input id="cpfResp" placeholder="000.000.000-00" />
        </div>
        <div>
          <label>RG (resp.)</label>
          <input id="rgResp" placeholder="" />
        </div>
        <div>
          <label>Telefone</label>
          <input id="telResp" placeholder="(99) 99999-9999" />
        </div>
      </div>
      <hr style="border-color:transparent; margin: 6px 0"/>
      <div class="grid cols-3">
        <div>
          <label>Endereço completo</label>
          <input id="endereco" placeholder="Rua, nº, complemento" />
        </div>
        <div>
          <label>Nº</label>
          <input id="numero" />
        </div>
        <div>
          <label>Bairro</label>
          <input id="bairro" />
        </div>
        <div>
          <label>CEP</label>
          <input id="cep" placeholder="00000-000" />
        </div>
        <div>
          <label>Cidade/UF</label>
          <input id="cidadeUf" placeholder="Cidade/UF" />
        </div>
      </div>
    </section>

    <!-- Aluno -->
    <section class="card">
      <h2>Aluno</h2>
      <div class="grid cols-4">
        <div class="col-span-2">
          <label>Nome do aluno</label>
          <input id="nomeAluno" />
        </div>
        <div>
          <label>Nasc. aluno</label>
          <input id="nascAluno" placeholder="DD/MM/AAAA" />
        </div>
        <div>
          <label>Sexo</label>
          <select id="sexoAluno">
            <option value="">—</option>
            <option>M</option>
            <option>F</option>
          </select>
        </div>
        <div>
          <label>RG aluno</label>
          <input id="rgAluno" />
        </div>
        <div>
          <label>CPF aluno</label>
          <input id="cpfAluno" placeholder="000.000.000-00" />
        </div>
        <div>
          <label>R.A</label>
          <input id="raAluno" />
        </div>
      </div>
    </section>

    <!-- Curso -->
    <section class="card">
      <h2>Curso</h2>
      <div class="grid cols-3">
        <div>
          <label>Profissionalizante</label>
          <input id="curso" placeholder="Nome do curso" />
        </div>
        <div>
          <label>Carga horária</label>
          <input id="carga" placeholder="Ex.: 160h" />
        </div>
        <div>
          <label>Contrato (nº)</label>
          <input id="contrato" placeholder="Número/identificação" />
        </div>
      </div>
    </section>

    <!-- Pagamento -->
    <section class="card">
      <h2>Pagamento</h2>
      <div class="grid cols-4">
        <div>
          <label>Valor total</label>
          <input id="total" placeholder="R$ 0,00" />
        </div>
        <div>
          <label>À vista</label>
          <input id="avista" placeholder="R$ 0,00" />
        </div>
        <div>
          <label>Desconto</label>
          <input id="desconto" placeholder="R$ 0,00" />
        </div>
        <div>
          <label>Parcela (genérica)</label>
          <input id="parcela" placeholder="R$ 0,00" />
        </div>
      </div>

      <div class="grid cols-4" style="margin-top:10px">
        <div>
          <label>Nº de parcelas</label>
          <input id="nParcelas" placeholder="Ex.: 12" />
        </div>
        <div data-show="cartao">
          <label>Parcela (Cartão)</label>
          <input id="parcCartao" placeholder="R$ 0,00" />
        </div>
        <div data-show="boleto">
          <label>Entrada (Boleto)</label>
          <input id="entrada" placeholder="R$ 0,00" />
        </div>
        <div data-show="boleto">
          <label>Parcela (Boleto)</label>
          <input id="parcBoleto" placeholder="R$ 0,00" />
        </div>
        <div data-show="boleto">
          <label>Dia vencimento</label>
          <input id="diaVenc" placeholder="01..28" />
        </div>
      </div>
      <div class="hint" style="margin-top:6px">Dica: informe pelo menos dois valores e o sistema completa o terceiro conforme a forma de pagamento.</div>
    </section>

    <!-- Ações -->
    <section class="card">
      <div class="actions">
        <button class="btn ghost" id="btnExemplo">Preencher Exemplo</button>
        <button class="btn warn" id="btnCalcular">Recalcular</button>
        <button class="btn ok" id="btnJson">Baixar JSON</button>
        <button class="btn primary" id="btnPdf">Gerar PDF</button>
        <button class="btn primary" id="btnDocx" style="background: linear-gradient(180deg, #059669, #047857);">Gerar DOCX</button>
      </div>
    </section>
  </main>

  <footer>Versão inicial • HTML + JavaScript puro • Compatível com cálculo automático (À vista, Cartão, Boleto) e exportação em PDF.</footer>

  <script>
    // ===== Utilidades de normalização/máscara =====
    const excTitle = new Set(["da","de","do","das","dos","e"]);
    const titleCase = (s="") => s.trim().split(/\s+/).map((p,i)=>{
      p = p.toLowerCase();
      if(i>0 && excTitle.has(p)) return p; return p.charAt(0).toUpperCase()+p.slice(1);
    }).join(" ");

    const onlyDigits = s => (s||"").replace(/\D+/g, "");

    function maskCPF(v){
      const d = onlyDigits(v).slice(0,11);
      if(d.length<=3) return d;
      if(d.length<=6) return `${d.slice(0,3)}.${d.slice(3)}`;
      if(d.length<=9) return `${d.slice(0,3)}.${d.slice(3,6)}.${d.slice(6)}`;
      return `${d.slice(0,3)}.${d.slice(3,6)}.${d.slice(6,9)}-${d.slice(9)}`;
    }
    function maskPhone(v){
      const d = onlyDigits(v).slice(0,11);
      if(d.length<=2) return d;
      if(d.length<=6) return `(${d.slice(0,2)}) ${d.slice(2)}`;
      if(d.length<=10) return `(${d.slice(0,2)}) ${d.slice(2,6)}-${d.slice(6)}`;
      return `(${d.slice(0,2)}) ${d.slice(2,7)}-${d.slice(7)}`;
    }
    function maskCEP(v){
      const d = onlyDigits(v).slice(0,8);
      if(d.length<=5) return d; return `${d.slice(0,5)}-${d.slice(5)}`;
    }
    function maskDate(v){
      const d = onlyDigits(v).slice(0,8);
      if(d.length<=2) return d; if(d.length<=4) return `${d.slice(0,2)}/${d.slice(2)}`;
      return `${d.slice(0,2)}/${d.slice(2,4)}/${d.slice(4)}`;
    }

    // BRL helpers (parse/fmt) compatíveis com seu Python
    function parseBRL(s){
      s = (s||"").trim(); if(!s) return 0; s = s.replace(/R\$|\s|\./g, "").replace(",", ".");
      const n = Number(s); return isFinite(n)? Math.round(n*100)/100 : 0;
    }
    function fmtBRL(n){
      n = Math.round((n||0)*100)/100; if(n<=0) return "";
      return (n<1? n.toFixed(2).replace(".", ",") : `R$ ${n.toFixed(2).replace(".",",")}`);
    }

    // ===== DOM helpers =====
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const get = id => $(id).value || "";
    const set = (id, v) => { $(id).value = v; };

    // aplica máscaras oninput
    const masks = [
      ["#cpfResp", maskCPF], ["#cpfAluno", maskCPF],
      ["#telResp", maskPhone], ["#cep", maskCEP],
      ["#data", maskDate], ["#nascResp", maskDate], ["#nascAluno", maskDate],
    ];
    masks.forEach(([sel, fn])=>{
      const el = $(sel); if(!el) return; el.addEventListener("input", e=>{ e.target.value = fn(e.target.value); });
    });

    // Title Case em nomes e endereços
    ["#nomeResp", "#nomeAluno", "#endereco", "#bairro", "#cidadeUf"].forEach(sel=>{
      const el = $(sel); if(!el) return; el.addEventListener("blur", e=>{ e.target.value = titleCase(e.target.value); });
    });

    // BRL auto-format em blur
    ["#total", "#avista", "#desconto", "#parcela", "#parcCartao", "#entrada", "#parcBoleto"].forEach(sel=>{
      const el = $(sel); if(!el) return; el.addEventListener("blur", e=>{ const v = parseBRL(e.target.value); e.target.value = fmtBRL(v); });
    });

    // ===== Lógica de exibição por forma =====
    function updateFormaUI(){
      const forma = get("#forma");
      $$('[data-show]').forEach(n=>{
        const showFor = n.getAttribute('data-show');
        const visible = (showFor === 'cartao' && forma === 'Cartão') || (showFor === 'boleto' && forma === 'Boleto');
        n.style.display = visible? 'block' : 'none';
      });
    }
    $("#forma").addEventListener('change', ()=>{ updateFormaUI(); recalc(true); });
    updateFormaUI();

    // Auto-calc toggle
    $("#auto").addEventListener('change', e=>{
      $("#pill-status").textContent = e.target.checked? "Ligado" : "Desligado";
    });

    // ===== Cálculo inspirado no seu CalculosMixin =====
    function recalc(quiet=true){
      if(!$("#auto").checked && quiet) return; // auto-calc off
      const forma = get("#forma");
      let total = parseBRL(get("#total"));
      let avista = parseBRL(get("#avista"));
      let cartaoParc = parseBRL(get("#parcCartao"));
      let entrada = parseBRL(get("#entrada"));
      let boletoParc = parseBRL(get("#parcBoleto"));
      const nRaw = onlyDigits(get("#nParcelas"));
      let n = nRaw? Math.min(Math.max(parseInt(nRaw,10)||0, 1), 36) : 0;
      if(n){ set("#nParcelas", String(n)); }

      // À vista: total ↔ avista
      if(forma === 'À vista'){
        if(total>0){ set('#avista', fmtBRL(total)); }
        else if(avista>0 && total===0){ set('#total', fmtBRL(avista)); }
        return;
      }

      // Cartão: precisa de n
      if(forma === 'Cartão'){
        if(n<1) return;
        if(cartaoParc>0 && total>0){
          const esperado = (cartaoParc*n);
          const tol = 0.01;
          if(Math.abs(total - esperado) > tol){
            // Ajusta parcela a partir do total
            const novaParc = +(total/n).toFixed(2);
            set('#parcCartao', fmtBRL(novaParc));
          }
          return;
        }
        if(cartaoParc>0 && total===0){
          set('#total', fmtBRL(cartaoParc*n));
        }else if(total>0 && cartaoParc===0){
          const p = +(total/n).toFixed(2);
          set('#parcCartao', fmtBRL(p));
        }
        return;
      }

      // Boleto: TOTAL = ENTRADA + (PARCELA * n)
      if(forma === 'Boleto'){
        if(n<1) return;
        const temTotal = total>0, temEntrada = entrada>0, temParc = boletoParc>0;
        if(temEntrada && temParc && !temTotal){
          set('#total', fmtBRL(entrada + boletoParc*n)); return;
        }
        if(temTotal && temEntrada && !temParc){
          const restante = Math.max(total-entrada,0); set('#parcBoleto', fmtBRL(restante/n)); return;
        }
        if(temTotal && temParc && !temEntrada){
          const ent = Math.max(total - boletoParc*n, 0); set('#entrada', fmtBRL(ent)); return;
        }
        if(temTotal && temEntrada && temParc){
          const esperado = entrada + boletoParc*n; const tol = 0.01;
          if(Math.abs(total-esperado) > tol){
            const novaParc = Math.max((total-entrada)/n, 0); set('#parcBoleto', fmtBRL(novaParc));
          }
        }
        return;
      }
    }

    // recalcular em mudanças relevantes
    ["#total", "#avista", "#parcCartao", "#entrada", "#parcBoleto", "#nParcelas"].forEach(sel=>{
      const el = $(sel); if(!el) return; el.addEventListener('input', ()=>recalc(false)); el.addEventListener('blur', ()=>recalc(true));
    });

    // ===== Exportar JSON =====
    function coletar(){
      const dados = {
        "CONTRATO": get('#contrato'),
        "DATA": get('#data'),
        "NOME COMPLETO": get('#nomeResp'),
        "NASC RESP": get('#nascResp'),
        "CPF": get('#cpfResp'),
        "RG RESPONSAVEL": get('#rgResp'),
        "TELEFONE": get('#telResp'),
        "ENDEREÇO COMPLETO": get('#endereco'),
        "N CS": get('#numero'),
        "BAIRRO": get('#bairro'),
        "CEP": get('#cep'),
        "CID/EST": get('#cidadeUf'),
        "NOME DO ALUNO": get('#nomeAluno'),
        "NASC ALUNO": get('#nascAluno'),
        "CPF DO ALUNO": get('#cpfAluno'),
        "RG ALUNO": get('#rgAluno'),
        "PROFISSIONALIZANTE": get('#curso'),
        "CARGA HORÁRIA": get('#carga'),
        "VALOR TOTAL": get('#total'),
        "VALOR À VISTA": get('#avista'),
        "DESCONTO": get('#desconto'),
        "PARCELA": get('#parcela'),
        "NÚMERO DE PARCELAS": get('#nParcelas'),
        "VALOR PARCELA CARTÃO": get('#parcCartao'),
        "VALOR ENTRADA": get('#entrada'),
        "VALOR PARCELA BOLETO": get('#parcBoleto'),
        "DIA VENCIMENTO": get('#diaVenc'),
        _meta: {
          modelo: get('#modelo'), forma: get('#forma')
        }
      };
      return dados;
    }

    $("#btnJson").addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(coletar(), null, 2)], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'contrato.json'; a.click(); URL.revokeObjectURL(a.href);
    });

    // ===== Gerar PDF (resumo do contrato) =====
    $("#btnPdf").addEventListener('click', ()=>{
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const d = coletar();

      const lines = [];
      lines.push(['Contrato', d['CONTRATO']]);
      lines.push(['Data', d['DATA']]);
      lines.push(['Responsável', d['NOME COMPLETO']]);
      lines.push(['CPF (resp.)', d['CPF']]);
      lines.push(['Telefone', d['TELEFONE']]);
      lines.push(['Endereço', `${d['ENDEREÇO COMPLETO']}, Nº ${d['N CS']} — ${d['BAIRRO']} — ${d['CEP']} — ${d['CID/EST']}`]);
      lines.push(['Aluno', d['NOME DO ALUNO']]);
      lines.push(['CPF (aluno)', d['CPF DO ALUNO']]);
      lines.push(['Curso', `${d['PROFISSIONALIZANTE']} (${d['CARGA HORÁRIA']})`]);
      lines.push(['Forma', d._meta.forma]);
      lines.push(['Total', d['VALOR TOTAL']]);
      lines.push(['À vista', d['VALOR À VISTA']]);
      if(d._meta.forma==='Cartão'){
        lines.push(['Parcelas (Cartão)', `${d['NÚMERO DE PARCELAS']} × ${d['VALOR PARCELA CARTÃO']}`]);
      }
      if(d._meta.forma==='Boleto'){
        lines.push(['Entrada (Boleto)', d['VALOR ENTRADA']]);
        lines.push(['Parcelas (Boleto)', `${d['NÚMERO DE PARCELAS']} × ${d['VALOR PARCELA BOLETO']} (venc. dia ${d['DIA VENCIMENTO']})`]);
      }
      if(d['DESCONTO']) lines.push(['Desconto', d['DESCONTO']]);

      // título
      doc.setFont('helvetica','bold');
      doc.setFontSize(16);
      doc.text('Resumo do Contrato', 56, 64);
      doc.setFontSize(10);
      doc.setTextColor(120);
      doc.text(`Modelo: ${d._meta.modelo}`, 56, 80);
      doc.setTextColor(0);

      // tabela simples
      let y = 110; const lh = 18;
      doc.setFont('helvetica','normal'); doc.setFontSize(12);
      lines.forEach(([k,v])=>{
        if(!v) return; doc.text(String(k)+":", 56, y); doc.text(String(v), 180, y, {maxWidth: 360}); y += lh;
      });

      // rodapé
      y += 14; doc.setDrawColor(200); doc.line(56, y, 540, y);
      doc.setFontSize(9); doc.setTextColor(120); y += 18;
      doc.text('Documento gerado automaticamente — Gerador de Contratos (Web)', 56, y);

      doc.save('Contrato.pdf');
    });

    // ===== Gerar DOCX (documento Word) =====
    $("#btnDocx").addEventListener('click', async ()=>{
      const d = coletar();
      
      try {
        const { Document, Paragraph, TextRun, HeadingLevel, AlignmentType, Table, TableRow, TableCell, WidthType } = docx;
        
        // Criar documento
        const doc = new Document({
          sections: [{
            properties: {},
            children: [
              // Título
              new Paragraph({
                children: [
                  new TextRun({
                    text: "CONTRATO DE PRESTAÇÃO DE SERVIÇOS EDUCACIONAIS",
                    bold: true,
                    size: 28,
                  }),
                ],
                heading: HeadingLevel.TITLE,
                alignment: AlignmentType.CENTER,
              }),
              
              // Informações do contrato
              new Paragraph({ text: "" }), // linha em branco
              new Paragraph({
                children: [
                  new TextRun({ text: "Contrato Nº: ", bold: true }),
                  new TextRun({ text: d['CONTRATO'] || 'N/A' }),
                  new TextRun({ text: "\tData: ", bold: true }),
                  new TextRun({ text: d['DATA'] || 'N/A' }),
                ],
              }),
              
              new Paragraph({ text: "" }), // linha em branco
              
              // Seção do Responsável
              new Paragraph({
                children: [new TextRun({ text: "DADOS DO RESPONSÁVEL FINANCEIRO", bold: true, size: 24 })],
                heading: HeadingLevel.HEADING_1,
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Nome: ", bold: true }),
                  new TextRun({ text: d['NOME COMPLETO'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "CPF: ", bold: true }),
                  new TextRun({ text: d['CPF'] || '' }),
                  new TextRun({ text: "\tRG: ", bold: true }),
                  new TextRun({ text: d['RG RESPONSAVEL'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Data de Nascimento: ", bold: true }),
                  new TextRun({ text: d['NASC RESP'] || '' }),
                  new TextRun({ text: "\tTelefone: ", bold: true }),
                  new TextRun({ text: d['TELEFONE'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Endereço: ", bold: true }),
                  new TextRun({ text: `${d['ENDEREÇO COMPLETO'] || ''}, Nº ${d['N CS'] || ''} - ${d['BAIRRO'] || ''} - CEP: ${d['CEP'] || ''} - ${d['CID/EST'] || ''}` }),
                ],
              }),
              
              new Paragraph({ text: "" }), // linha em branco
              
              // Seção do Aluno
              new Paragraph({
                children: [new TextRun({ text: "DADOS DO ALUNO", bold: true, size: 24 })],
                heading: HeadingLevel.HEADING_1,
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Nome do Aluno: ", bold: true }),
                  new TextRun({ text: d['NOME DO ALUNO'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "CPF: ", bold: true }),
                  new TextRun({ text: d['CPF DO ALUNO'] || '' }),
                  new TextRun({ text: "\tRG: ", bold: true }),
                  new TextRun({ text: d['RG ALUNO'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Data de Nascimento: ", bold: true }),
                  new TextRun({ text: d['NASC ALUNO'] || '' }),
                ],
              }),
              
              new Paragraph({ text: "" }), // linha em branco
              
              // Seção do Curso
              new Paragraph({
                children: [new TextRun({ text: "DADOS DO CURSO", bold: true, size: 24 })],
                heading: HeadingLevel.HEADING_1,
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Curso: ", bold: true }),
                  new TextRun({ text: d['PROFISSIONALIZANTE'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Carga Horária: ", bold: true }),
                  new TextRun({ text: d['CARGA HORÁRIA'] || '' }),
                ],
              }),
              
              new Paragraph({ text: "" }), // linha em branco
              
              // Seção Financeira
              new Paragraph({
                children: [new TextRun({ text: "INFORMAÇÕES FINANCEIRAS", bold: true, size: 24 })],
                heading: HeadingLevel.HEADING_1,
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Forma de Pagamento: ", bold: true }),
                  new TextRun({ text: d._meta?.forma || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Valor Total: ", bold: true }),
                  new TextRun({ text: d['VALOR TOTAL'] || '' }),
                ],
              }),
              
              new Paragraph({
                children: [
                  new TextRun({ text: "Valor à Vista: ", bold: true }),
                  new TextRun({ text: d['VALOR À VISTA'] || '' }),
                ],
              }),
            ],
          }],
        });
        
        // Adicionar informações específicas da forma de pagamento
        if (d._meta?.forma === 'Cartão' && d['NÚMERO DE PARCELAS']) {
          doc.addSection({
            children: [
              new Paragraph({
                children: [
                  new TextRun({ text: "Parcelamento no Cartão: ", bold: true }),
                  new TextRun({ text: `${d['NÚMERO DE PARCELAS']} parcelas de ${d['VALOR PARCELA CARTÃO'] || ''}` }),
                ],
              }),
            ],
          });
        }
        
        if (d._meta?.forma === 'Boleto') {
          doc.addSection({
            children: [
              new Paragraph({
                children: [
                  new TextRun({ text: "Pagamento via Boleto - Entrada: ", bold: true }),
                  new TextRun({ text: d['VALOR ENTRADA'] || '' }),
                ],
              }),
              new Paragraph({
                children: [
                  new TextRun({ text: "Parcelas: ", bold: true }),
                  new TextRun({ text: `${d['NÚMERO DE PARCELAS']} parcelas de ${d['VALOR PARCELA BOLETO'] || ''} (Vencimento dia ${d['DIA VENCIMENTO'] || ''})` }),
                ],
              }),
            ],
          });
        }
        
        // Gerar e baixar
        const buffer = await docx.Packer.toBlob(doc);
        const url = URL.createObjectURL(buffer);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Contrato_${d['CONTRATO'] || 'documento'}.docx`;
        a.click();
        URL.revokeObjectURL(url);
        
      } catch (error) {
        console.error('Erro ao gerar DOCX:', error);
        alert('Erro ao gerar documento Word. Verifique se todos os campos estão preenchidos.');
      }
    });

    // ===== Exemplo rápido =====
    $("#btnExemplo").addEventListener('click', ()=>{
      set('#modelo','Contrato_EJA'); set('#forma','Cartão'); updateFormaUI();
      set('#data', maskDate('01022026'));
      set('#nomeResp', titleCase('maria de souza almeida'));
      set('#nascResp', maskDate('05091986'));
      set('#cpfResp', maskCPF('39015451706'));
      set('#rgResp', '1234567');
      set('#telResp', maskPhone('94988887777'));
      set('#endereco', titleCase('rua bernardo sayao'));
      set('#numero', '189'); set('#bairro', titleCase('centro'));
      set('#cep', maskCEP('68140000'));
      set('#cidadeUf', titleCase('uruara/pa'));
      set('#nomeAluno', titleCase('joao vitor almeida'));
      set('#nascAluno', maskDate('12102012'));
      set('#cpfAluno', maskCPF('12312312312'));
      set('#rgAluno', '7778889');
      set('#curso', 'Técnico em Enfermagem'); set('#carga', '1200h'); set('#contrato', '001/2026');
      set('#nParcelas','12'); set('#parcCartao', fmtBRL(199.90)); set('#total',''); recalc(false);
    });

    // Ações manuais
    $("#btnCalcular").addEventListener('click', ()=> recalc(false));
  </script>
</body>
</html>